version: "3.7"

services:
  nodeA:
    depends_on:
      - storeA
    build: ../../../fred
    image: fred/fred:local
    container_name: nodeA
    command: --remote-storage-host "172.26.0.20:1337" --zmq-host "172.26.0.10:5555" --nodeID "nodeA" --host ":9001"  --cert "/cert/nodeA.crt" --key "/cert/nodeA.key" --adaptor "remote" --nase-host "https://172.26.1.1:2379" --nase-cert "/cert/nodeA.crt" --nase-key "/cert/nodeA.key" --nase-ca "/cert/ca.crt" --log-level "debug" --handler "dev" --badgerdb-path "./db"
    volumes:
      - ../../nase/tls/nodeA.crt:/cert/nodeA.crt
      - ../../nase/tls/nodeA.key:/cert/nodeA.key
      - ../../nase/tls/ca.crt:/cert/ca.crt
    ports:
      - 9002:9001
    networks:
      fredwork:
        ipv4_address: 172.26.0.10

  nodeB:
    build: ../../../fred
    depends_on:
      - storeB
    image: fred/fred:local
    container_name: nodeB
    command: --remote-storage-host "172.26.0.21:1337" --zmq-host "172.26.0.11:5555" --nodeID "nodeB" --host ":9001" --cert "/cert/nodeB.crt" --key "/cert/nodeB.key" --adaptor "remote" --nase-host "https://172.26.1.1:2379" --nase-cert "/cert/nodeB.crt" --nase-key "/cert/nodeB.key" --nase-ca "/cert/ca.crt" --log-level "debug" --handler "dev" --badgerdb-path "./db"
    volumes:
      - ../../nase/tls/nodeB.crt:/cert/nodeB.crt
      - ../../nase/tls/nodeB.key:/cert/nodeB.key
      - ../../nase/tls/ca.crt:/cert/ca.crt
    ports:
      - 9003:9001
    networks:
      fredwork:
        ipv4_address: 172.26.0.11

  nodeC:
    build: ../../../fred
    depends_on:
      - storeC
    image: fred/fred:local
    container_name: nodeC
    command: --remote-storage-host "172.26.0.22:1337" --zmq-host "172.26.0.12:5555" --nodeID "nodeC" --host ":9001" --cert "/cert/nodeC.crt" --key "/cert/nodeC.key" --adaptor "remote" --nase-host "https://172.26.1.1:2379" --nase-cert "/cert/nodeC.crt" --nase-key "/cert/nodeC.key" --nase-ca "/cert/ca.crt" --log-level "debug" --handler "dev" --badgerdb-path "./db"
    volumes:
      - ../../nase/tls/nodeC.crt:/cert/nodeC.crt
      - ../../nase/tls/nodeC.key:/cert/nodeC.key
      - ../../nase/tls/ca.crt:/cert/ca.crt
    ports:
      - 9004:9001
    networks:
      fredwork:
        ipv4_address: 172.26.0.12

networks:
  fredwork:
    external: true
# docker network create fredwork --gateway 172.26.0.1 --subnet 172.26.0.0/16
